<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>iGuhit</title>
    <link rel="icon" type="image/x-icon" href="./iGuhitFavCon-01.ico">
    <link rel="stylesheet" href=".\jquery-ui.css">
    <link rel="stylesheet" href=".\style.css">
    <script type="text/javascript" canvas="canvas" defer src=".\paper-full.js"></script>
    <script type="text/javascript" canvas="canvas" defer src=".\paper-core.js"></script>
    <script type="text/javascript" canvas="canvas" defer src=".\jQuery.js"></script>
    <script type="text/javascript" canvas="canvas" defer src=".\jquery-ui.js"></script>
    <!-- <script defer type="text/paperscript" canvas="canvas"></script>  -->
    <script defer type="text/paperscript" canvas="canvas">
                // aim to make a smooth and reliable software tool like adobe illustrator
        // globals
        paper.install(window);
        var spiokoks;
        var artboard, raster;
        var itemOldWidth, itemOldHeight;
        var group;
        var selectGroup;
        var changeTool;
        var segment, path, handles;
        var movePath = false;
        var currentSegment, mode, type;
        var shapeTrim1, shapeTrim2, shapeTrim3, shapeResult, combinedShape, combinedShape2, cloneCopy;
        var newZoom, zoomStartPos, zoomEndPos, mousePosition, viewPosition;
        var handToolPan, artboardMove, diffDelta, pathScaled, itemScaledH, itemScaledY, moveDrag;

        // variables for artboard
        var artboardWidth = document.getElementById('controlWidth').value * 300;
        var artboardHeight = document.getElementById('controlHeight').value * 300;

        // get the html element and add click function
        document.getElementById('freePen').addEventListener("click", freePenFunction);
        document.getElementById('moveTool').addEventListener("click", moveToolFunction);
        document.getElementById('pathEdit').addEventListener("click", pathEditing);
        document.getElementById('penTool').addEventListener("click", penTool);
        document.getElementById('zoomTool').addEventListener("click", zoomTool);
        document.getElementById('shapeTrimmer').addEventListener("click", shapeTrimmer);
        document.getElementById('handTool').addEventListener("click", handTool);
        document.getElementById('canvasUpdateButton').addEventListener("click", canvasResizedWH);
        document.getElementById('toolPropertiesLabelBtn').addEventListener("click", toolPropertiesLabelBtn);
        document.getElementById('download-to-svg').addEventListener("click", downloadSVG);

        var toolFreePen = document.getElementById('freePen');
        var toolMove = document.getElementById('moveTool');
        var toolPathEdit = document.getElementById('pathEdit');
        var toolPen = document.getElementById('penTool');
        var toolZoom = document.getElementById('zoomTool');
        var toolShapeTrim = document.getElementById('shapeTrimmer');
        var toolHand = document.getElementById('handTool');

        // key down global switching tools
        tool.onKeyDown = function (event) {
            // toolSwitch section from pen
            if (event.key == 'z') {
                return zoomTool();
            }
            if (event.key == 'p') {
                return penTool();
            }
            if (event.key == 'a') {
                return pathEditing();
            }
            if (event.key == 'h') {
                return handTool();
            }
            if (event.key == 's') {
                return shapeTrimmer();
            }
            if (event.key == 'n') {
                return freePenFunction();
            }
            if (event.key == 'v') {
                return moveToolFunction();
            }
        }

        // function for resizing canvas
        function canvasResizedWH() {
            artboard.bounds.width = document.getElementById('controlWidth').value * 300;
            artboard.bounds.height = document.getElementById('controlHeight').value * 300;
            return artboard;
        }
        // function for resizing items using input fields
        function toolPropertiesLabelBtn() {
            item.bounds.width = document.getElementById('itemWidth').value * 300;
            item.bounds.height = document.getElementById('itemHeight').value * 300;
            item.position.x = document.getElementById('itemXlocation').value * 300;
            item.position.y = document.getElementById('itemYlocation').value * 300;
            return item;
        }

        // Get the input field for width
        var itemWidth = document.getElementById("itemWidth");
        // Execute a function when the user presses a key on the keyboard
        itemWidth.addEventListener("keypress", function (event) {
            // If the user presses the "Enter" key on the keyboard
            if (event.key === "Enter") {
                // Cancel the default action, if needed
                event.preventDefault();
                // execute your code here
                item.bounds.width = document.getElementById('itemWidth').value * 300;
                var itemNewWidth = item.bounds.width;
                var scaleFactor = (itemOldWidth / 300) / (itemNewWidth / 300);
                item.bounds.height = item.bounds.height / scaleFactor;
            }
        });

        // Get the input field for height
        var itemHeight = document.getElementById("itemHeight");
        // Execute a function when the user presses a key on the keyboard
        itemHeight.addEventListener("keypress", function (event) {
            // If the user presses the "Enter" key on the keyboard
            if (event.key === "Enter") {
                // Cancel the default action, if needed
                event.preventDefault();
                // execute your code here
                item.bounds.height = document.getElementById('itemHeight').value * 300;
                var itemNewHeight = item.bounds.height;
                var scaleFactorHeight = (itemOldHeight / 300) / (itemNewHeight / 300);
                item.bounds.width = item.bounds.width / scaleFactorHeight;
            }
        });

        // Get the input field for colorPicker
        var inputColorPicker = document.getElementById("inputColor");
        // Execute a function when the user presses a key on the keyboard
        inputColorPicker.addEventListener("keypress", function (event) {
            // If the user presses the "Enter" key on the keyboard
            if (event.key === "Enter") {
                // Cancel the default action, if needed
                event.preventDefault();
                // execute your code here
                item.fillColor = document.getElementById('inputColor').value;
                document.getElementById('colorPickPreview').style.backgroundColor = document.getElementById('inputColor').value;
            }
        });

        // Get the input field for colorPickerStroke
        var inputColorPickerStroke = document.getElementById("inputColorStroke");
        // Execute a function when the user presses a key on the keyboard
        inputColorPickerStroke.addEventListener("keypress", function (event) {
            // If the user presses the "Enter" key on the keyboard
            if (event.key === "Enter") {
                // Cancel the default action, if needed
                event.preventDefault();
                // execute your code here
                item.strokeColor = document.getElementById('inputColorStroke').value;
                document.getElementById('colorPickPreviewStroke').style.backgroundColor = document.getElementById('inputColorStroke').value;
            }
        });

        // Get the input field for strokeThickness
        var strokeThickness = document.getElementById("strokeThickness");
        // Execute a function when the user presses a key on the keyboard
        strokeThickness.addEventListener("keypress", function (event) {
            // If the user presses the "Enter" key on the keyboard
            if (event.key === "Enter") {
                // Cancel the default action, if needed
                event.preventDefault();
                // execute your code here
                item.strokeWidth = document.getElementById('strokeThickness').value;
            }
        });

        // ARTBOARD SECTION
        var rectangle = new Rectangle(new Point(0, 0), artboardWidth, artboardHeight);
        artboard = new Path.Rectangle(rectangle);
        artboard.position = paper.view.center;
        artboard.fillColor = 'white';
        artboard.locked = true;

        // import section
        var imageUpload = document.getElementById('imageUpload');
        imageUpload.onchange = function () {
            const [file] = imageUpload.files
            if (file) {
                myImageUrl = URL.createObjectURL(file);
            }
            var raster = new Raster({ source: myImageUrl, position: view.center });
            raster.onLoad = function () {
                console.log('Successfully loaded image!');
            };
        }

        // export section
        function downloadSVG() {
            var fileName = "iGuhit.svg"
            // var url = "data:image/svg+xml;utf8," + encodeURIComponent(paper.project.exportSVG({ asString: true }));
            var url = "data:image/svg+xml;utf8," + encodeURIComponent(paper.project.exportSVG({ asString: true }));
            var link = document.createElement("a");
            link.download = fileName;
            link.href = url;
            link.click();
            alert('file saved successfully');
        }

        // TOGGLE FOR TOOLS EFFECTS
        function pathEditing() {
            toolFreePen.classList.remove("toolToggle");
            toolMove.classList.remove("toolToggle");
            toolPathEdit.classList.add("toolToggle");
            toolPen.classList.remove("toolToggle");
            toolZoom.classList.remove("toolToggle");
            toolShapeTrim.classList.remove("toolToggle");
            toolHand.classList.remove("toolToggle");
            if (shapeTrim1, shapeTrim2, shapeTrim3) {
                shapeTrim1.remove();
                shapeTrim2.remove();
                shapeTrim3.remove();
            }
            return changeTool = 'pathEdit';
        }
        function moveToolFunction() {
            toolFreePen.classList.remove("toolToggle");
            toolMove.classList.add("toolToggle");
            toolPathEdit.classList.remove("toolToggle");
            toolPen.classList.remove("toolToggle");
            toolZoom.classList.remove("toolToggle");
            toolShapeTrim.classList.remove("toolToggle");
            toolHand.classList.remove("toolToggle");
            if (shapeTrim1, shapeTrim2, shapeTrim3) {
                shapeTrim1.remove();
                shapeTrim2.remove();
                shapeTrim3.remove();
            }
            return changeTool = 'moveTool';
        }
        function freePenFunction() {
            toolFreePen.classList.add("toolToggle");
            toolMove.classList.remove("toolToggle");
            toolPathEdit.classList.remove("toolToggle");
            toolPen.classList.remove("toolToggle");
            toolZoom.classList.remove("toolToggle");
            toolShapeTrim.classList.remove("toolToggle");
            toolHand.classList.remove("toolToggle");

            if (shapeTrim1, shapeTrim2, shapeTrim3) {
                shapeTrim1.remove();
                shapeTrim2.remove();
                shapeTrim3.remove();
            }
            return changeTool = 'pen';
        }
        function penTool() {
            toolFreePen.classList.remove("toolToggle");
            toolMove.classList.remove("toolToggle");
            toolPathEdit.classList.remove("toolToggle");
            toolPen.classList.add("toolToggle");
            toolZoom.classList.remove("toolToggle");
            toolShapeTrim.classList.remove("toolToggle");
            toolHand.classList.remove("toolToggle");

            if (shapeTrim1, shapeTrim2, shapeTrim3) {
                shapeTrim1.remove();
                shapeTrim2.remove();
                shapeTrim3.remove();
            }
            return changeTool = 'penTool';
        }
        function zoomTool() {
            toolFreePen.classList.remove("toolToggle");
            toolMove.classList.remove("toolToggle");
            toolPathEdit.classList.remove("toolToggle");
            toolPen.classList.remove("toolToggle");
            toolZoom.classList.add("toolToggle");
            toolShapeTrim.classList.remove("toolToggle");
            toolHand.classList.remove("toolToggle");
            if (shapeTrim1, shapeTrim2, shapeTrim3) {
                shapeTrim1.remove();
                shapeTrim2.remove();
                shapeTrim3.remove();
            }
            return changeTool = 'zoomTool';
        }
        function handTool() {
            toolFreePen.classList.remove("toolToggle");
            toolMove.classList.remove("toolToggle");
            toolPathEdit.classList.remove("toolToggle");
            toolPen.classList.remove("toolToggle");
            toolZoom.classList.remove("toolToggle");
            toolShapeTrim.classList.remove("toolToggle");
            toolHand.classList.add("toolToggle");
            if (shapeTrim1, shapeTrim2, shapeTrim3) {
                shapeTrim1.remove();
                shapeTrim2.remove();
                shapeTrim3.remove();
            }
            return changeTool = 'handTool';
        }
        function shapeTrimmer() {
            toolFreePen.classList.remove("toolToggle");
            toolMove.classList.remove("toolToggle");
            toolPathEdit.classList.remove("toolToggle");
            toolPen.classList.remove("toolToggle");
            toolZoom.classList.remove("toolToggle");
            toolShapeTrim.classList.add("toolToggle");
            toolHand.classList.remove("toolToggle");

            if (selectGroup.length > 2) return alert('sorry we cant operate more than 2 objects');
            // converts the array selectGroup into a group first
            selectGroup = new Group(selectGroup);
            // continue if selectGroup is not null or it has a value greater then 1
            if (selectGroup && selectGroup.children.length > 1) {
                selectGroup.children[0].bounds.selected = false;
                selectGroup.children[1].bounds.selected = false;
                shapeTrim1 = selectGroup.children[0].subtract(selectGroup.children[1]);
                shapeTrim2 = selectGroup.children[0].intersect(selectGroup.children[1]);
                shapeTrim3 = selectGroup.children[1].subtract(selectGroup.children[0]);
                shapeTrim1.bounds.selected = false;
                shapeTrim2.bounds.selected = false;
                shapeTrim3.bounds.selected = false;

                if (shapeTrim1 && shapeTrim1.segments != undefined && shapeTrim1.segments.length > 2) {
                    shapeTrim1.selected = true;
                    shapeTrim1.fillColor = { hue: 240, alpha: 0.01 };
                    selectGroup.addChild(shapeTrim1);
                }
                if (shapeTrim2 && shapeTrim2.segments != undefined && shapeTrim2.segments.length > 2) {
                    shapeTrim2.selected = true;
                    shapeTrim2.fillColor = { hue: 240, alpha: 0.01 };
                    selectGroup.addChild(shapeTrim2);
                }
                if (shapeTrim3 && shapeTrim3.segments != undefined && shapeTrim3.segments.length > 2) {
                    shapeTrim3.selected = true;
                    shapeTrim3.fillColor = { hue: 240, alpha: 0.01 };
                    selectGroup.addChild(shapeTrim3);
                }
            } else {
                return;
            }
            return changeTool = 'shapeTrimmer';
        }

        // VIP variables
        var values = {
            paths: 50,
            minPoints: 5,
            maxPoints: 15,
            minRadius: 30,
            maxRadius: 90
        };
        var hitOptions = {
            segments: true,
            handles: true,
            stroke: true,
            fill: true,
            bounds: true,
            tolerance: 5
        };
        var hitOptionsMove = {
            fill: true,
            bounds: true,
            stroke: true,
            tolerance: 10
        };
        var hitOptionsDrag = {
            segments: true,
            handles: true,
            stroke: true,
            fill: true,
            bounds: true,
            tolerance: 10
        };

        // MOUSE EVENTS SECTION
        var types = ['point', 'handleIn', 'handleOut'];
        function findHandle(point) {
            for (var i = 0, l = path.segments.length; i < l; i++) {
                for (var j = 0; j < 3; j++) {
                    var type = types[j];
                    var segment = path.segments[i];
                    var segmentPoint = type == 'point'
                        ? segment.point
                        : segment.point + segment[type];
                    var distance = (point - segmentPoint).length;
                    if (distance < 3) {
                        return {
                            type: type,
                            segment: segment
                        };
                    }
                }
            }
            return null;
        }
        // mouseDown section
        function onMouseDown(event) {
            // spiokoks = window.location.href;
            // if (spiokoks != 'https://sensielong.github.io/iGuhit/') return;

            // freepen section
            if (changeTool === 'pen') {
                tool.onKeyDown = function (event) {
                    // toolSwitch section from pen
                    if (event.key == 'z') {
                        return zoomTool();
                    }
                    if (event.key == 'p') {
                        return penTool();
                    }
                    if (event.key == 'e') {
                        return pathEditing();
                    }
                    if (event.key == 'h') {
                        return handTool();
                    }
                    if (event.key == 's') {
                        return shapeTrimmer();
                    }
                    if (event.key == 'n') {
                        return freePenFunction();
                    }
                    if (event.key == 'v') {
                        return moveToolFunction();
                    }
                }
                // If we produced a path before, deselect it:
                if (path) {
                    path.selected = false;
                }

                // Create a new path and set its stroke color to black:
                path = new Path({
                    segments: [event.point],
                    strokeColor: 'black',
                    // Select the path, so we can see its segment points:
                    fullySelected: true
                });
            }
            // moveTool section
            if (changeTool === 'moveTool') {
                segment = path = handles = null;
                // move keyboard interaction
                tool.onKeyDown = function (event) {
                    if (event.key == 'delete') {
                        if (!item.selected) {
                            alert('anong buburahin mo?');
                        } else {
                            var toBeDeletedFiles = new Group(project.selectedItems);
                            toBeDeletedFiles.remove();
                            return false;
                        }
                    }

                    if (event.key == '{') {
                        if (selectGroup && selectGroup.length > 0) {
                            for (i = 0; i < selectGroup.length; i++) {
                                item = selectGroup[i];
                                item.sendToBack();
                                artboard.sendToBack();
                            }
                        }
                    }

                    if (event.key == '}') {
                        if (selectGroup && selectGroup.length > 0) {
                            for (i = 0; i < selectGroup.length; i++) {
                                item = selectGroup[i];
                                item.bringToFront();
                                artboard.sendToBack();
                            }
                        }
                    }

                    if (event.key == ']') {
                        if (selectGroup && selectGroup.length > 0) {
                            for (i = 0; i < selectGroup.length; i++) {
                                item = selectGroup[i];
                                item.insertAbove(item.nextSibling);
                                artboard.sendToBack();
                            }
                        }
                    }

                    if (event.key == '[') {
                        if (selectGroup && selectGroup.length > 0) {
                            for (i = 0; i < selectGroup.length; i++) {
                                item = selectGroup[i];
                                item.insertBelow(item.previousSibling);
                                artboard.sendToBack();
                            }
                        }
                    }

                    // toolSwitch section
                    if (event.key == 'z') {
                        return zoomTool();
                    }
                    if (event.key == 'p') {
                        return penTool();
                    }
                    if (event.key == 'e') {
                        return pathEditing();
                    }
                    if (event.key == 'h') {
                        return handTool();
                    }
                    if (event.key == 's') {
                        return shapeTrimmer();
                    }
                    if (event.key == 'n') {
                        return freePenFunction();
                    }
                    if (event.key == 'v') {
                        return moveToolFunction();
                    }
                }

                // move hitest
                if (event.modifiers.space) {
                    handToolPan = project.activeLayer.children;
                }
                if (event.modifiers.shift) {
                    var hitResult = project.hitTest(event.point, hitOptionsMove);
                    if (hitResult) {
                        item = hitResult.item;
                        item.selected = false;
                        item.bounds.selected = false;
                        selectGroup = project.selectedItems;
                    }
                } else {
                    var hitResult = project.hitTest(event.point, hitOptionsMove);
                    // if the hit is fill then proceed
                    if (hitResult && hitResult.type != 'bounds' && hitResult.item.className != 'CompoundPath') {
                        item = hitResult.item;
                        item.selected = true;
                        selectGroup = project.selectedItems;

                        // remove the fill of the item when hit
                        var removeFill = document.getElementById('myItemFill');
                        removeFill.addEventListener('click', function () {
                            item.fillColor = null;
                        });

                        // set the size of the item in input field
                        document.getElementById('itemXlocation').value = (Math.floor(item.position.x)) / 300;
                        document.getElementById('itemYlocation').value = (Math.floor(item.position.y)) / 300;
                        document.getElementById('itemWidth').value = (Math.floor(item.bounds.width)) / 300;
                        document.getElementById('itemHeight').value = (Math.floor(item.bounds.height)) / 300;
                        itemOldWidth = document.getElementById('itemWidth').value * 300;
                        itemOldHeight = document.getElementById('itemHeight').value * 300;

                        // get the color of the item and put it into the input field
                        document.getElementById('inputColor').value = item.fillColor;
                        document.getElementById('colorPickPreview').style.backgroundColor = document.getElementById('inputColor').value;
                        document.getElementById('inputColorStroke').value = item.strokeColor;
                        document.getElementById('colorPickPreviewStroke').style.backgroundColor = document.getElementById('inputColorStroke').value;
                        document.getElementById('strokeThickness').value = item.strokeWidth;

                        if (selectGroup.length > 0) {
                            for (i = 0; i < selectGroup.length; i++) {
                                selectGroup[i].bounds.selected = true;
                            }
                        }

                        if (event.modifiers.alt) {
                            if (selectGroup.length > 0) {
                                for (i = 0; i < selectGroup.length; i++) {
                                    selectGroup[i].selected = false;
                                    selectGroup[i].bounds.selected = false;
                                    cloneCopy = selectGroup[i].clone();
                                    cloneCopy.selected = true;
                                }
                            };
                            moveDrag = 'ready';
                            selectGroup.selected = false;
                            return;
                        }
                        moveDrag = 'ready';
                        return selectGroup;
                    }

                    // if the hit is compoundPath then proceed
                    if (hitResult && hitResult.type === 'fill' && hitResult.item.className == 'CompoundPath') {
                        item = hitResult.item;
                        item.selected = true;
                        selectGroup = project.selectedItems;

                        // set the size of the item in input field
                        document.getElementById('itemXlocation').value = (Math.floor(item.position.x)) / 300;
                        document.getElementById('itemYlocation').value = (Math.floor(item.position.y)) / 300;
                        document.getElementById('itemWidth').value = (Math.floor(item.bounds.width)) / 300;
                        document.getElementById('itemHeight').value = (Math.floor(item.bounds.height)) / 300;
                        itemOldWidth = document.getElementById('itemWidth').value * 300;
                        itemOldHeight = document.getElementById('itemHeight').value * 300;

                        // get the color of the item and put it into the input field
                        document.getElementById('inputColor').value = item.fillColor;
                        document.getElementById('colorPickPreview').style.backgroundColor = document.getElementById('inputColor').value;
                        document.getElementById('inputColorStroke').value = item.strokeColor;
                        document.getElementById('colorPickPreviewStroke').style.backgroundColor = document.getElementById('inputColorStroke').value;
                        document.getElementById('strokeThickness').value = item.strokeWidth;

                        if (selectGroup.length > 0) {
                            for (i = 0; i < selectGroup.length; i++) {
                                selectGroup[i].bounds.selected = true;
                            }
                        }

                        if (event.modifiers.alt) {
                            if (selectGroup.length > 0) {
                                for (i = 0; i < selectGroup.length; i++) {
                                    selectGroup[i].selected = false;
                                    selectGroup[i].bounds.selected = false;
                                    cloneCopy = selectGroup[i].clone();
                                    cloneCopy.selected = true;
                                }
                            };
                            moveDrag = 'ready';
                            selectGroup.selected = false;
                            return;
                        }
                        moveDrag = 'ready';
                        return selectGroup;
                    }

                    // if the hit is bounds then proceed
                    if (hitResult && hitResult.type === 'bounds') {
                        tool.onKeyDown = function (event) {
                            if (event.key == ']') {
                                if (selectGroup && selectGroup.length > 0) {
                                    item.insertAbove(item.nextSibling);
                                    artboard.sendToBack();
                                }
                            }

                            if (event.key == '[') {
                                if (selectGroup && selectGroup.length > 0) {
                                    item.insertBelow(item.previousSibling);
                                    artboard.sendToBack();
                                }
                            }
                            if (event.key == '{') {
                                if (selectGroup && selectGroup.length > 0) {
                                    item.sendToBack();
                                    artboard.sendToBack();
                                }
                            }
                            if (event.key == '}') {
                                if (selectGroup && selectGroup.length > 0) {
                                    item.bringToFront();
                                    artboard.sendToBack();
                                }
                            }
                            // group the selected item when pressing key g
                            if (event.key == 'g') {
                                group = new Group(selectGroup);
                            }
                        }
                        item = hitResult.item;
                        pathScaled = 'ready';
                    }
                    // if there is no hit
                    if (!hitResult) {
                        pathScaled = item = null;
                        if (selectGroup) {
                            for (i = 0; i < selectGroup.length; i++) {
                                selectGroup[i].bounds.selected = false;
                            }
                        }
                        project.activeLayer.bounds.selected = false;
                        project.activeLayer.selected = false;
                        project.activeLayer.fullySelected = false;
                        return selectGroup = null;
                    }
                }
            }
            // path editing section
            if (changeTool === 'pathEdit') {
                segment = path = handles = null;
                tool.onKeyDown = function (event) {
                    if (event.key == 'delete') {
                        if (!path) {
                            alert('anong buburahin mo?');
                        } else {
                            path.remove();
                            return false;
                        }
                    }
                    // toolSwitch section from pen
                    if (event.key == 'z') {
                        return zoomTool();
                    }
                    if (event.key == 'p') {
                        return penTool();
                    }
                    if (event.key == 'e') {
                        return pathEditing();
                    }
                    if (event.key == 'h') {
                        return handTool();
                    }
                    if (event.key == 's') {
                        return shapeTrimmer();
                    }
                    if (event.key == 'n') {
                        return freePenFunction();
                    }
                    if (event.key == 'v') {
                        return moveToolFunction();
                    }
                }
                var hitResult = project.hitTest(event.point, hitOptions);
                if (!hitResult)
                    return;
                // event modifiers section
                if (event.modifiers.space) {
                    handToolPan = project.activeLayer.children;
                }

                if (event.modifiers.alt) {
                    if (hitResult.type == 'segment') {
                        hitResult.segment.handleOut = null;
                    };
                    return;
                }

                if (event.modifiers.shift) {
                    if (hitResult.type == 'segment') {
                        if (hitResult.segment.handleIn != null) {
                            hitResult.segment.handleIn = null;
                        } else {
                            return;
                        }
                    };
                    return;
                }
                if (event.modifiers.control) {
                    if (hitResult.type == 'segment') {
                        hitResult.segment.smooth();
                    };
                    return;
                }
                if (event.modifiers.capsLock) {
                    if (hitResult.type == 'segment') {
                        hitResult.segment.remove();
                    };
                    return;
                }

                if (hitResult) {
                    path = hitResult.item;
                    if (hitResult.type == 'segment') {
                        segment = hitResult.segment;
                    } else if (hitResult.type == 'handle-in') {
                        handles = hitResult.segment;
                        handlePoints = hitResult.type;
                    } else if (hitResult.type == 'handle-out') {
                        handles = hitResult.segment;
                        handlePoints = hitResult.type;
                    } else if (hitResult.type == 'stroke') {
                        var location = hitResult.location;
                        segment = path.insert(location.index + 1, event.point);
                    }
                }

                movePath = hitResult.type == 'fill';
                if (movePath) {
                    project.activeLayer.addChild(hitResult.item);
                    path.fullySelected = true;
                }
            }
            // for penTool section
            if (changeTool === 'penTool') {
                if (currentSegment)
                    currentSegment.selected = false;
                mode = type = currentSegment = null;

                if (!path) {
                    path = new Path();
                    // path.fillColor = document.getElementById('inputColor').value;
                    // path.fillColor = {
                    //    hue: 360 * Math.random(),
                    //    saturation: 1,
                    //    brightness: 1,
                    // };
                    path.strokeColor = 'black';
                }

                var result = findHandle(event.point);
                if (result) {
                    currentSegment = result.segment;
                    type = result.type;

                    // check if this event is on the first array of segments and closed the path if ever
                    if (path.segments.length > 1 && result.type == 'point'
                        && result.segment.index == 0) {
                        mode = 'close';
                        path.closed = true;
                        path.selected = false;
                        path = null;
                    }
                }
                // if the event.point is not in the first array point of the segment? then add segement
                if (mode != 'close') {
                    mode = currentSegment ? 'move' : 'add';

                    tool.onKeyDown = function (event) {
                        if (event.key == 'x') {
                            if (!currentSegment) {
                                alert('wala kapa ngang path');
                            } else {
                                currentSegment.remove();
                                currentSegment = path.lastSegment;
                                return false;
                            }
                        }
                        // toolSwitch section from pen
                        if (event.key == 'z') {
                            return zoomTool();
                        }
                        if (event.key == 'p') {
                            return penTool();
                        }
                        if (event.key == 'e') {
                            return pathEditing();
                        }
                        if (event.key == 'h') {
                            return handTool();
                        }
                        if (event.key == 's') {
                            return shapeTrimmer();
                        }
                        if (event.key == 'n') {
                            return freePenFunction();
                        }
                        if (event.key == 'v') {
                            return moveToolFunction();
                        }
                    }

                    if (!currentSegment) {
                        currentSegment = path.add(event.point);
                    }
                    if (event.modifiers.space) {
                        handToolPan = project.activeLayer.children;
                    }
                    if (event.modifiers.alt) {
                        if (currentSegment) {
                            currentSegment.handleOut = null;
                        };
                        return currentSegment.selected = true;
                    }
                    if (event.modifiers.shift) {
                        if (currentSegment) {
                            currentSegment.handleIn = null;
                        };
                        return currentSegment.selected = true;
                    }
                    if (event.modifiers.control) {
                        if (currentSegment) {
                            currentSegment.remove();
                        };
                        return currentSegment.selected = true;
                    }

                    currentSegment.selected = true;
                }
            }
            // for shapeTrimmer section
            if (changeTool === 'shapeTrimmer') {
                tool.onKeyDown = function (event) {
                    // toolSwitch section from pen
                    if (event.key == 'z') {
                        return zoomTool();
                    }
                    if (event.key == 'p') {
                        return penTool();
                    }
                    if (event.key == 'e') {
                        return pathEditing();
                    }
                    if (event.key == 'h') {
                        return handTool();
                    }
                    if (event.key == 's') {
                        return shapeTrimmer();
                    }
                    if (event.key == 'n') {
                        return freePenFunction();
                    }
                    if (event.key == 'v') {
                        return moveToolFunction();
                    }
                }
                var hitResult = project.hitTest(event.point, hitOptions);
                if (selectGroup === undefined) return console.log('wala pa tayong selection');
                if (selectGroup.children.length > 1) {
                    if (hitResult && hitResult.item && hitResult.item == shapeTrim1) {
                        if (shapeTrim1.segments != undefined && shapeTrim1.segments.length > 2) {
                            shapeResult = selectGroup.children[0].subtract(selectGroup.children[1]);
                            combinedShape = selectGroup.children[1];
                            selectGroup.removeChildren();
                            selectGroup.addChild(shapeResult);
                            selectGroup.addChild(combinedShape);
                        } else {
                            shapeResult = selectGroup.children[0].subtract(selectGroup.children[1]);
                            selectGroup.removeChildren();
                            selectGroup.addChild(shapeResult);
                        }
                        return selectGroup = selectGroup.children;
                    }
                    if (hitResult && hitResult.item && hitResult.item == shapeTrim2) {
                        if (shapeTrim2.segments.length > 2) {
                            shapeResult = selectGroup.children[0].intersect(selectGroup.children[1]);
                            combinedShape = selectGroup.children[0].subtract(selectGroup.children[1]);
                            combinedShape2 = selectGroup.children[1].subtract(selectGroup.children[0]);
                            selectGroup.removeChildren();
                            selectGroup.addChild(shapeResult);
                            selectGroup.addChild(combinedShape);
                            selectGroup.addChild(combinedShape2);
                        }
                        return selectGroup = selectGroup.children;
                    }
                    if (hitResult && hitResult.item && hitResult.item == shapeTrim3) {
                        if (shapeTrim3.segments != undefined && shapeTrim3.segments.length > 2) {
                            shapeResult = selectGroup.children[1].subtract(selectGroup.children[0]);
                            combinedShape = selectGroup.children[0];
                            selectGroup.removeChildren();
                            selectGroup.addChild(shapeResult);
                            selectGroup.addChild(combinedShape);
                        } else {
                            shapeResult = selectGroup.children[1].subtract(selectGroup.children[0]);
                            selectGroup.removeChildren();
                            selectGroup.addChild(shapeResult);
                        }
                        return selectGroup = selectGroup.children;
                    }
                }
            }
            // zoom section
            if (changeTool === 'zoomTool') {
                tool.onKeyDown = function (event) {
                    // toolSwitch section from pen
                    if (event.key == 'z') {
                        return zoomTool();
                    }
                    if (event.key == 'p') {
                        return penTool();
                    }
                    if (event.key == 'e') {
                        return pathEditing();
                    }
                    if (event.key == 'h') {
                        return handTool();
                    }
                    if (event.key == 's') {
                        return shapeTrimmer();
                    }
                    if (event.key == 'n') {
                        return freePenFunction();
                    }
                    if (event.key == 'v') {
                        return moveToolFunction();
                    }
                }
                if (event.modifiers.shift) {
                    newZoom = paper.view.zoom * 0.95;

                } else if (event.modifiers.control) {
                    newZoom = paper.view.zoom * 0.5;

                } else if (event.modifiers.alt) {
                    newZoom = paper.view.zoom = 1;

                    // center everything in the canvas
                    artboardMove = project.activeLayer.children;
                    diffDelta = new Point(paper.view.center.x - artboard.position.x, paper.view.center.y - artboard.position.y);

                    for (var i = 0; i < artboardMove.length; i++) {
                        artboardMove[i].position += diffDelta;
                    }

                } else if (event.modifiers.space) {
                    handToolPan = project.activeLayer.children;
                } else {
                    newZoom = paper.view.zoom * 1.05;
                }
                paper.view.zoom = newZoom;
                paper.view.draw();
            }
            // handTool section
            if (changeTool === 'handTool') {
                handToolPan = project.activeLayer.children;
                tool.onKeyDown = function (event) {
                    // toolSwitch section from pen
                    if (event.key == 'z') {
                        return zoomTool();
                    }
                    if (event.key == 'p') {
                        return penTool();
                    }
                    if (event.key == 'e') {
                        return pathEditing();
                    }
                    if (event.key == 'h') {
                        return handTool();
                    }
                    if (event.key == 's') {
                        return shapeTrimmer();
                    }
                    if (event.key == 'n') {
                        return freePenFunction();
                    }
                    if (event.key == 'v') {
                        return moveToolFunction();
                    }
                }
            }
        }
        // mouseMove section
        function onMouseMove(event) {
            if (changeTool === 'pathEdit') {
                var hitResult = project.hitTest(event.point, hitOptions);
                project.activeLayer.selected = false;
                if (hitResult && hitResult.item)
                    hitResult.item.fullySelected = true;
            }
            if (changeTool === 'shapeTrimmer') {
                var hitResult = project.hitTest(event.point, hitOptions);
                project.activeLayer.selected = false;
                if (hitResult && hitResult.item) {
                    hitResult.item.fullySelected = true;
                }
            }
        }
        // mouseDrag section
        function onMouseDrag(event) {
            // freePen section
            if (changeTool === 'pen') {
                path.add(event.point);
            }
            // moveTool section.
            if (changeTool === 'moveTool') {
                if (event.modifiers.space) {
                    for (var i = 0; i < handToolPan.length; i++) {
                        handToolPan[i].position += event.delta;
                    }
                } else {
                    if (pathScaled === 'ready') {
                        document.getElementById('itemXlocation').value = (Math.floor(item.position.x)) / 300;
                        document.getElementById('itemYlocation').value = (Math.floor(item.position.y)) / 300;
                        document.getElementById('itemWidth').value = (Math.floor(item.bounds.width)) / 300;
                        document.getElementById('itemHeight').value = (Math.floor(item.bounds.height)) / 300;
                        if (event.modifiers.shift) {
                            item.bounds.width = (event.point.x - item.bounds.topLeft.x);
                        } else if (event.modifiers.alt) {
                            item.bounds.height = (event.point.y - item.bounds.topLeft.y);
                        } else if (event.modifiers.control) {
                            item.bounds.width = (event.point.x - item.bounds.topLeft.x);
                            item.bounds.height = (event.point.y - item.bounds.topLeft.y);
                        } else {
                            var constraintsScale = item.bounds.width;
                            item.bounds.width = (event.point.x - item.bounds.topLeft.x);
                            var heightConstraints = item.bounds.width / constraintsScale;
                            item.bounds.height = item.bounds.height * heightConstraints;
                        }
                    } else if (selectGroup && moveDrag === 'ready') {
                        document.getElementById('itemXlocation').value = (Math.floor(item.position.x)) / 300;
                        document.getElementById('itemYlocation').value = (Math.floor(item.position.y)) / 300;
                        document.getElementById('itemWidth').value = (Math.floor(item.bounds.width)) / 300;
                        document.getElementById('itemHeight').value = (Math.floor(item.bounds.height)) / 300;
                        for (i = 0; i < selectGroup.length; i++) {
                            item = selectGroup[i];
                            item.translate(event.delta);
                        }
                        return;
                    } else {
                        // if nothing is selected using drag, select everything in its way
                        var hitResult = project.hitTest(event.point, hitOptionsMove);
                        if (hitResult) {
                            item = hitResult.item;
                            item.selected = true;
                            selectGroup = project.selectedItems;
                        }
                    }
                }
            }
            // path editing section
            if (changeTool === 'pathEdit') {
                if (event.modifiers.space) {
                    for (var i = 0; i < handToolPan.length; i++) {
                        handToolPan[i].position += event.delta;
                    }
                } else if (segment) {
                    segment.point += event.delta;
                    //path.smooth();
                } else if (handles) {
                    if (handlePoints == 'handle-in') {
                        handles.handleIn += event.delta;
                    } else if (handlePoints == 'handle-out') {
                        handles.handleOut += event.delta;
                    }
                } else if (path) {
                    path.position += event.delta;
                }
            }
            // penTool section
            if (changeTool === 'penTool') {
                if (event.modifiers.space) {
                    for (var i = 0; i < handToolPan.length; i++) {
                        handToolPan[i].position += event.delta;
                    }
                } else if (mode == 'move' && type == 'point') {
                    currentSegment.point = event.point;
                } else if (mode != 'close') {
                    var delta = event.delta.clone();
                    if (type == 'handleOut' || mode == 'add')
                        delta = -delta;
                    currentSegment.handleIn += delta;
                    currentSegment.handleOut -= delta;
                }
            }
            // zoomTool section
            if (changeTool === 'zoomTool') {
                if (event.modifiers.space) {
                    ;
                    for (var i = 0; i < handToolPan.length; i++) {
                        handToolPan[i].position += event.delta;
                    }
                } else {
                    zoomStartPos = new Point(event.delta);
                    if (zoomStartPos.x > 0 && zoomStartPos.y > 0) {
                        newZoom = paper.view.zoom * 1.02;
                    } else if (zoomStartPos.x > 0 && zoomStartPos.y < 0 || zoomStartPos.x < 0 && zoomStartPos.y > 0) {
                        newZoom = paper.view.zoom * 1;
                    } else {
                        newZoom = paper.view.zoom * 0.98;
                    }
                    paper.view.zoom = newZoom;
                    paper.view.draw();
                }
            }
            // handTool section for drag
            if (changeTool === 'handTool') {
                for (var i = 0; i < handToolPan.length; i++) {
                    handToolPan[i].position += event.delta;
                }
            }
        }
        // mouseUp section
        function onMouseUp(event) {
            // freePen section
            if (changeTool === 'pen') {
                // var segmentCount = path.segments.length;

                // When the mouse is released, simplify it:
                path.simplify(10);

                // Select the path, so we can see its segments:
                path.fullySelected = true;

                // var newSegmentCount = path.segments.length;
                // var difference = segmentCount - newSegmentCount;
                // var percentage = 100 - Math.round(newSegmentCount / segmentCount * 100);
                // textItem.content = difference + ' of the ' + segmentCount + ' segments were removed. Saving ' + percentage + '%';
                path.fillColor = {
                    hue: 360 * Math.random(),
                    saturation: 1,
                    brightness: 1,
                };
                path.closed = true;
            }
            // pathEdit section in mouse up event
            if (changeTool === 'pathEdit') {
                if (!path) {
                    return;
                } else {
                    path.fullySelected = true;
                }
            }
            // moveTool section in up
            if (changeTool === 'moveTool') {
                pathScaled = moveDrag = null;
            }
        }

        // jQuery section
        $(function () {
            $("#toolContainer").draggable();
            $("#controlContainer").draggable();
            $("#toolProperties").draggable();

            // move the focus of input fields after pressing enter
            var inputs = $(':input').keypress(function (e) {
                if (e.which == 13) {
                    e.preventDefault();
                    var nextInput = inputs.get(inputs.index(this) + 1);
                    if (nextInput) {
                        nextInput.focus();
                    }
                }
            });
        });
    </script>
</head>
<body>
    <div id="toolControl">
        <div id="toolContainer">
            <img src=".\toolImages\bx-move.svg" class="toolIcon" id="moveTool" />
            <img src=".\toolImages\bxs-pencil.svg" class="toolIcon" id="freePen" />
            <img src=".\toolImages\shapeTrimmer.svg" class="toolIcon" id="shapeTrimmer" />
            <img src=".\toolImages\bx-edit.svg" class="toolIcon" id="pathEdit" />
            <img src=".\toolImages\bxs-pen.svg" class="toolIcon" id="penTool" />
            <img src=".\toolImages\bx-zoom-in.svg" class="toolIcon" id="zoomTool" />
            <img src=".\toolImages\bxs-hand.svg" class="toolIcon" id="handTool" />
        </div>
        <div id="controlContainer">
            <input type="file" class="buttonGlobal" id="imageUpload" name="imageUpload" accept="image/jpeg, image/png, image/svg" style="display: none;" />
            <label id="uploadFile" for="imageUpload" class="globalText">Upload file</label>

            <button id="download-to-svg" class="buttonGlobal">EXPORT SVG</button>
            <p id="canvasLabel">Canvas Size:</p>
            <p class="widthHeight">Width :</p>
            <input type="text" id="controlWidth" class="inputWidthSize" value="3.5" />
            <p class="widthHeight">Height :</p>
            <input type="text" id="controlHeight" class="inputWidthSize" value="2" />
            <p class="widthHeight">in</p>
            <button id="canvasUpdateButton"><strong>✓</strong></button>
        </div>
    </div>
    <div id="canvasContainer">
        <canvas id="canvas"></canvas>
    </div>
    <div id="toolPropertiesContainer">
        <div id="toolProperties">

            <p id="myItemFill" class="toolPropertiesLabel">fill:</p>
            <div id="colorPickPreview"></div>
            <input type="text" id="inputColor" class="inputWidthSize" value="#000000" />

            <p class="toolPropertiesLabel">stroke:</p>
            <div id="colorPickPreviewStroke"></div>
            <input type="text" id="inputColorStroke" class="inputWidthSize" value="#000000" />
            <input type="text" id="strokeThickness" class="strokeThicknessClass" value="0" />

            <p class="toolPropertiesLabel">align:</p>
            <img src="./control_images/align_left.svg" class="toolControlIcon" id="alignLeft" />
            <img src="./control_images/align_center-01.svg" class="toolControlIcon" id="alignCenter" />
            <img src="./control_images/align_right.svg" class="toolControlIcon" id="alignRight" />
            <p class="toolPropertiesLabel">---</p>
            <img src="./control_images/align_top.svg" class="toolControlIcon" id="alignTop" />
            <img src="./control_images/align_V_center.svg" class="toolControlIcon" id="alignVerticalCenter" />
            <img src="./control_images/align_bottom.svg" class="toolControlIcon" id="alignBot" />


            <p class="toolPropertiesLabel">X:</p>
            <input type="text" id="itemXlocation" class="inputWidthSize" value="x pos" />
            <p class="toolPropertiesLabel">Y:</p>
            <input type="text" id="itemYlocation" class="inputWidthSize" value="y pos" />
            <p class="toolPropertiesLabel">W:</p>
            <input type="text" id="itemWidth" class="inputWidthSize" value="width" />
            <p class="toolPropertiesLabel">H:</p>
            <input type="text" id="itemHeight" class="inputWidthSize" value="height" />
            <button id="toolPropertiesLabelBtn"><strong>✓</strong></button>

        </div>
    </div>
</body>
</html>
